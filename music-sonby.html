<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reproductor Fullscreen con fondo dinámico y controles centrados</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      width: 100%;
      background: black;
      color: white;
      font-family: system-ui, sans-serif;
      user-select: none;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #backgroundBlur {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-position: center;
      background-size: cover;
      filter: brightness(0.45) saturate(1.2) blur(20px);
      z-index: -1;
      transition: background-image 1s ease-in-out, opacity 1s ease-in-out;
      opacity: 0;
    }
    #backgroundBlur.visible {
      opacity: 1;
    }
    #app {
      display: flex;
      flex-direction: column;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(to bottom, rgba(45,22,0,0.85) 0%, rgba(0,0,0,0.95) 100%);
      padding: 0;
      overflow: hidden;
    }

    .shimmer-wrapper {
      position: relative;
      overflow: hidden;
      background: #222;
      width: 100%;
      height: 60vh;
      margin-bottom: 0;
    }
    .shimmer {
      position: absolute;
      top: 0; left: -150%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255 255 255 / 0.15), transparent);
      animation: shimmer 1.6s infinite;
      will-change: left;
    }
    @keyframes shimmer {
      100% {
        left: 150%;
      }
    }

    #albumCover {
      width: 100%;
      height: 60vh;
      object-fit: cover;
      display: none;
      user-select: none;
      pointer-events: none;
      box-shadow: 0 10px 30px rgb(0 0 0 / 0.9);
      border-radius: 0 0 2rem 2rem;
      transition: opacity 0.8s ease;
    }

    .info {
      text-align: center;
      padding: 0.8rem 1rem 1rem 1rem;
      flex-shrink: 0;
      user-select: text;
    }
    .track-title {
      font-weight: 700;
      font-size: 2.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-artist {
      font-size: 1.2rem;
      color: #aaa;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .like-icon {
      font-size: 2.2rem;
      opacity: 0.7;
      cursor: pointer;
      transition: opacity 0.3s ease;
      margin-bottom: 1rem;
      text-align: center;
      user-select: none;
      color: inherit;
    }
    .like-icon:hover {
      opacity: 1;
    }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 95%;
      height: 12px;
      border-radius: 9999px;
      background: linear-gradient(
        to right,
        #34d399 0%,
        #34d399 var(--range-progress),
        #444 var(--range-progress),
        #444 100%
      );
      cursor: pointer;
      margin: 0 auto 0.8rem auto;
      transition: background 0.3s ease;
      position: relative;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      background: #10b981;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px #10b981;
      border: none;
      margin-top: -9px;
      transition: background-color 0.3s ease;
      position: relative;
      z-index: 3;
    }
    input[type="range"]:hover::-webkit-slider-thumb {
      background: #059669;
      box-shadow: 0 0 15px #059669;
    }
    input[type="range"]::-moz-range-track {
      height: 12px;
      border-radius: 9999px;
      background: transparent;
    }
    input[type="range"]::-moz-range-progress {
      background-color: #34d399;
      height: 12px;
      border-radius: 9999px;
    }
    input[type="range"]::-moz-range-thumb {
      width: 28px;
      height: 28px;
      background: #10b981;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #10b981;
      transition: background-color 0.3s ease;
    }
    input[type="range"]:hover::-moz-range-thumb {
      background: #059669;
      box-shadow: 0 0 15px #059669;
    }

    .time-labels {
      font-size: 0.95rem;
      color: #888;
      display: flex;
      justify-content: space-between;
      margin: 0 5% 1.2rem 5%;
      user-select: none;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 3rem;
      padding-bottom: 1.5rem;
      user-select: none;
    }

    .controls button {
      background: transparent;
      border: none;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      aspect-ratio: 1 / 1;
      border-radius: 0.5rem;
      padding: 0.5rem;
    }
    .controls button:hover {
      opacity: 1;
      background: rgb(16 185 129 / 0.2);
    }
    #playBtn {
      background: white;
      color: black;
      width: 90px;
      height: 90px;
      border-radius: 9999px;
      box-shadow: 0 10px 25px rgb(0 0 0 / 0.7);
      font-size: 2.8rem;
      opacity: 1 !important;
      transition: background-color 0.3s ease, color 0.3s ease;
      flex-shrink: 0;
    }
    #playBtn:hover {
      background-color: #10b981;
      color: white;
      box-shadow: 0 12px 30px #10b981;
    }

    #downloadBtn, #shareBtn {
      font-size: 2.4rem;
      width: 56px;
      height: 56px;
    }

    .active-btn {
      color: #34d399 !important;
      opacity: 1 !important;
    }

    @media (max-width: 600px) {
      .track-title {
        font-size: 1.8rem;
      }
      .track-artist {
        font-size: 1rem;
      }
      #playBtn {
        width: 72px;
        height: 72px;
        font-size: 2.2rem;
      }
      .controls {
        gap: 2rem;
        padding-bottom: 1rem;
      }
      #downloadBtn, #shareBtn {
        width: 44px;
        height: 44px;
        font-size: 2rem;
      }
      input[type="range"] {
        width: 90%;
      }
      .time-labels {
        margin: 0 5% 0.8rem 5%;
      }
    }
    @media (max-width: 350px) {
      .track-title {
        font-size: 1.4rem;
      }
      .track-artist {
        font-size: 0.85rem;
      }
      #playBtn {
        width: 56px;
        height: 56px;
        font-size: 1.8rem;
      }
      .controls {
        gap: 1.2rem;
        padding-bottom: 0.8rem;
      }
      #downloadBtn, #shareBtn {
        width: 36px;
        height: 36px;
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <div id="backgroundBlur" aria-hidden="true"></div>

  <main id="app" role="main" aria-label="Reproductor de música fullscreen" tabindex="0">

    <div class="shimmer-wrapper" id="shimmerPlaceholder" aria-hidden="true">
      <div class="shimmer"></div>
    </div>
    <img id="albumCover" alt="Portada del álbum" />

    <section class="info" aria-live="polite">
      <h1 id="trackTitle" class="track-title">Título</h1>
      <p id="trackArtist" class="track-artist">Artista</p>
    </section>

    <div class="like-icon" role="button" tabindex="0" aria-label="Me gusta" id="likeBtn">
      <i class="fa-regular fa-heart"></i>
    </div>

    <audio id="audio" crossorigin="anonymous"></audio>

    <input type="range" id="progress" value="0" aria-label="Barra de progreso de la canción" style="--range-progress: 0%;" />

    <div class="time-labels">
      <span id="current">0:00</span>
      <span id="total">0:00</span>
    </div>

    <nav class="controls" aria-label="Controles de reproducción">
      <button id="downloadBtn" aria-label="Descargar canción" title="Descargar">
        <i class="fa-solid fa-download"></i>
      </button>

      <button id="playBtn" aria-label="Reproducir/Pausar">
        <i class="fa-solid fa-play" id="playIcon"></i>
      </button>

      <button id="shareBtn" aria-label="Compartir canción" title="Compartir">
        <i class="fa-solid fa-share-nodes"></i>
      </button>
    </nav>

  </main>

  <script>
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const progress = document.getElementById('progress');
    const current = document.getElementById('current');
    const total = document.getElementById('total');

    const downloadBtn = document.getElementById('downloadBtn');
    const shareBtn = document.getElementById('shareBtn');

    const albumCoverImg = document.getElementById('albumCover');
    const shimmerPlaceholder = document.getElementById('shimmerPlaceholder');
    const trackTitleElem = document.getElementById('trackTitle');
    const trackArtistElem = document.getElementById('trackArtist');
    const backgroundBlur = document.getElementById('backgroundBlur');

    const likeBtn = document.getElementById('likeBtn');
    const likeIcon = likeBtn.querySelector('i');

    let isPlaying = false;

    function formatTime(sec) {
      if (isNaN(sec)) return '0:00';
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updatePlayPauseIcon() {
      if (isPlaying) {
        playIcon.classList.replace('fa-play', 'fa-pause');
      } else {
        playIcon.classList.replace('fa-pause', 'fa-play');
      }
    }

    function showShimmer() {
      shimmerPlaceholder.style.display = 'block';
      albumCoverImg.style.display = 'none';
      backgroundBlur.classList.remove('visible');
    }

    function hideShimmer() {
      shimmerPlaceholder.style.display = 'none';
      albumCoverImg.style.display = 'block';
      backgroundBlur.classList.add('visible');
    }

    function updateProgressBackground(value) {
      progress.style.setProperty('--range-progress', `${value}%`);
    }

    function loadFromURL() {
      const params = new URLSearchParams(window.location.search);
      const mp3Url = params.get('mp3');
      const downloadUrl = params.get('descarga') || mp3Url;  // Si no existe descarga, usa mp3
      const imgUrl = params.get('img');
      const titleParam = params.get('title') || 'Título';
      const artistParam = params.get('artist') || 'Artista';

      if (!mp3Url) {
        return false;
      }

      audio.src = mp3Url;
      trackTitleElem.textContent = titleParam;
      trackArtistElem.textContent = artistParam;

      showShimmer();
      albumCoverImg.src = imgUrl || 'https://via.placeholder.com/800x600?text=Portada';

      albumCoverImg.onload = () => {
        hideShimmer();
        backgroundBlur.style.backgroundImage = `url('${albumCoverImg.src}')`;
      };

      albumCoverImg.onerror = () => {
        hideShimmer();
        backgroundBlur.style.backgroundImage = `url('https://via.placeholder.com/800x600?text=Portada')`;
      };

      downloadBtn.dataset.url = downloadUrl;
      shareBtn.dataset.url = mp3Url;

      return true;
    }

    audio.addEventListener('loadedmetadata', () => {
      total.textContent = formatTime(audio.duration);
    });

    audio.addEventListener('timeupdate', () => {
      if (audio.duration) {
        const percent = (audio.currentTime / audio.duration) * 100;
        progress.value = percent;
        current.textContent = formatTime(audio.currentTime);
        updateProgressBackground(percent);
      }
    });

    progress.addEventListener('input', () => {
      if (audio.duration) {
        audio.currentTime = (progress.value / 100) * audio.duration;
        updateProgressBackground(progress.value);
      }
    });

    playBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        isPlaying = true;
      } else {
        audio.pause();
        isPlaying = false;
      }
      updatePlayPauseIcon();
    });

    likeBtn.addEventListener('click', () => {
      if (likeIcon.classList.contains('fa-regular')) {
        likeIcon.classList.remove('fa-regular');
        likeIcon.classList.add('fa-solid');
        likeIcon.style.color = '#10b981'; // verde
      } else {
        likeIcon.classList.remove('fa-solid');
        likeIcon.classList.add('fa-regular');
        likeIcon.style.color = 'inherit';
      }
    });

    likeBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        likeBtn.click();
      }
    });

    downloadBtn.addEventListener('click', () => {
      const url = downloadBtn.dataset.url || '';
      if (url) {
        window.location.href = `otra-pagina.html?descarga=${encodeURIComponent(url)}`;
      }
    });

    shareBtn.addEventListener('click', () => {
      const url = shareBtn.dataset.url || '';
      if (url) {
        window.location.href = `otra-pagina.html?compartir=${encodeURIComponent(url)}`;
      }
    });

    window.onload = () => {
      loadFromURL();
      updatePlayPauseIcon();
    };
  </script>

</body>
</html>
