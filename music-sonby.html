<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reproductor Fullscreen Responsivo Avanzado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      width: 100%;
      background: black;
      color: white;
      font-family: system-ui, sans-serif;
      user-select: none;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #backgroundBlur {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-position: center;
      background-size: cover;
      filter: blur(24px);
      transform: scale(1.1);
      z-index: -1;
      transition: background-image 0.5s ease-in-out;
      will-change: background-image;
    }
    #app {
      display: flex;
      flex-direction: column;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(to bottom, #2d1600 0%, black 100%);
      padding: 0;
      overflow: hidden;
    }

    /* Shimmer placeholder */
    .shimmer-wrapper {
      position: relative;
      overflow: hidden;
      background: #222;
      width: 100%;
      height: 60vh;
      margin-bottom: 0;
    }
    .shimmer {
      position: absolute;
      top: 0; left: -150%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255 255 255 / 0.15), transparent);
      animation: shimmer 1.6s infinite;
      will-change: left;
    }
    @keyframes shimmer {
      100% {
        left: 150%;
      }
    }

    #albumCover {
      width: 100%;
      height: 60vh;
      object-fit: cover;
      display: none;
      user-select: none;
      pointer-events: none;
      box-shadow: 0 10px 20px rgb(0 0 0 / 0.7);
    }

    .info {
      text-align: center;
      padding: 0.8rem 1rem 1rem 1rem;
      flex-shrink: 0;
      user-select: text;
    }
    .track-title {
      font-weight: 700;
      font-size: 2.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-artist {
      font-size: 1.2rem;
      color: #aaa;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .like-icon {
      font-size: 2.2rem;
      opacity: 0.7;
      cursor: pointer;
      transition: opacity 0.3s ease;
      margin-bottom: 1rem;
      text-align: center;
      user-select: none;
      color: inherit;
    }
    .like-icon:hover {
      opacity: 1;
    }

    /* Barra de progreso mejorada */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 95%;
      height: 12px;
      border-radius: 9999px;
      background: linear-gradient(
        to right,
        #34d399 0%,
        #34d399 var(--range-progress),
        #444 var(--range-progress),
        #444 100%
      );
      cursor: pointer;
      margin: 0 auto 0.3rem auto;
      transition: background 0.3s ease;
      position: relative;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      background: #10b981;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px #10b981;
      border: none;
      margin-top: -9px;
      transition: background-color 0.3s ease;
      position: relative;
      z-index: 3;
    }
    input[type="range"]:hover::-webkit-slider-thumb {
      background: #059669;
      box-shadow: 0 0 15px #059669;
    }
    input[type="range"]::-moz-range-track {
      height: 12px;
      border-radius: 9999px;
      background: transparent;
    }
    input[type="range"]::-moz-range-progress {
      background-color: #34d399;
      height: 12px;
      border-radius: 9999px;
    }
    input[type="range"]::-moz-range-thumb {
      width: 28px;
      height: 28px;
      background: #10b981;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #10b981;
      transition: background-color 0.3s ease;
    }
    input[type="range"]:hover::-moz-range-thumb {
      background: #059669;
      box-shadow: 0 0 15px #059669;
    }

    .time-labels {
      font-size: 0.95rem;
      color: #888;
      display: flex;
      justify-content: space-between;
      margin: 0 5% 1rem 5%;
      user-select: none;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      font-size: 2.8rem;
      padding: 0 1rem 1rem 1rem;
      flex-shrink: 0;
      user-select: none;
    }
    .controls button {
      background: transparent;
      border: none;
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.3s ease;
      padding: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      aspect-ratio: 1/1;
      width: 52px;
      height: 52px;
      will-change: opacity;
    }
    .controls button:hover {
      opacity: 1;
    }
    #playBtn {
      background: white;
      color: black;
      width: 72px;
      height: 72px;
      border-radius: 9999px;
      box-shadow: 0 8px 16px rgb(0 0 0 / 0.5);
      font-size: 2.2rem;
      opacity: 1 !important;
    }
    .active-btn {
      color: #34d399;
      opacity: 1 !important;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .track-title {
        font-size: 1.8rem;
      }
      .track-artist {
        font-size: 1rem;
      }
      #playBtn {
        width: 60px;
        height: 60px;
        font-size: 1.8rem;
      }
      .controls {
        font-size: 2rem;
        padding: 0 0.5rem 1rem 0.5rem;
      }
      .like-icon {
        font-size: 1.8rem;
        margin-bottom: 0.6rem;
      }
      input[type="range"] {
        width: 90%;
      }
      .time-labels {
        margin: 0 5% 0.8rem 5%;
      }
    }
    @media (max-width: 350px) {
      .track-title {
        font-size: 1.4rem;
      }
      .track-artist {
        font-size: 0.85rem;
      }
      #playBtn {
        width: 48px;
        height: 48px;
        font-size: 1.4rem;
      }
      .controls {
        font-size: 1.5rem;
        padding: 0 0.3rem 1rem 0.3rem;
      }
    }
  </style>
</head>
<body>

  <div id="backgroundBlur" aria-hidden="true"></div>

  <main id="app" role="main" aria-label="Reproductor de música fullscreen" tabindex="0">

    <div class="shimmer-wrapper" id="shimmerPlaceholder" aria-hidden="true">
      <div class="shimmer"></div>
    </div>
    <img id="albumCover" alt="Portada del álbum" />

    <section class="info" aria-live="polite">
      <h1 id="trackTitle" class="track-title">Título</h1>
      <p id="trackArtist" class="track-artist">Artista</p>
    </section>

    <div class="like-icon" role="button" tabindex="0" aria-label="Me gusta" id="likeBtn">
      <i class="fa-regular fa-heart"></i>
    </div>

    <audio id="audio" crossorigin="anonymous"></audio>

    <input type="range" id="progress" value="0" aria-label="Barra de progreso de la canción" style="--range-progress: 0%;" />

    <div class="time-labels">
      <span id="current">0:00</span>
      <span id="total">0:00</span>
    </div>

    <nav class="controls" aria-label="Controles de reproducción">
      <button id="shuffleBtn" aria-label="Reproducir aleatoriamente" title="Shuffle"><i class="fa-solid fa-shuffle"></i></button>
      <button id="back" aria-label="Pista anterior"><i class="fa-solid fa-backward-step"></i></button>
      <button id="playBtn" aria-label="Reproducir/Pausar">
        <i class="fa-solid fa-play" id="playIcon"></i>
      </button>
      <button id="next" aria-label="Pista siguiente"><i class="fa-solid fa-forward-step"></i></button>
      <button id="repeatBtn" aria-label="Repetir pista" title="Repetir"><i class="fa-solid fa-repeat"></i></button>
    </nav>

  </main>

  <script>
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const progress = document.getElementById('progress');
    const current = document.getElementById('current');
    const total = document.getElementById('total');
    const repeatBtn = document.getElementById('repeatBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const backBtn = document.getElementById('back');
    const nextBtn = document.getElementById('next');

    const albumCoverImg = document.getElementById('albumCover');
    const shimmerPlaceholder = document.getElementById('shimmerPlaceholder');
    const trackTitleElem = document.getElementById('trackTitle');
    const trackArtistElem = document.getElementById('trackArtist');
    const backgroundBlur = document.getElementById('backgroundBlur');

    const likeBtn = document.getElementById('likeBtn');
    const likeIcon = likeBtn.querySelector('i');

    let isRepeat = false;
    let isShuffle = false;
    let isPlaying = false;

    function formatTime(sec) {
      if (isNaN(sec)) return '0:00';
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updatePlayPauseIcon() {
      if (isPlaying) {
        playIcon.classList.replace('fa-play', 'fa-pause');
      } else {
        playIcon.classList.replace('fa-pause', 'fa-play');
      }
    }

    function showShimmer() {
      shimmerPlaceholder.style.display = 'block';
      albumCoverImg.style.display = 'none';
    }

    function hideShimmer() {
      shimmerPlaceholder.style.display = 'none';
      albumCoverImg.style.display = 'block';
    }

    function updateProgressBackground(value) {
      progress.style.setProperty('--range-progress', `${value}%`);
    }

    function loadFromURL() {
      const params = new URLSearchParams(window.location.search);
      const mp3Url = params.get('mp3');
      const imgUrl = params.get('img');
      const titleParam = params.get('title') || 'Título';
      const artistParam = params.get('artist') || 'Artista';

      if (!mp3Url) {
        // No hay URL, no cargar nada
        return false;
      }

      trackTitleElem.textContent = titleParam;
      trackArtistElem.textContent = artistParam;

      showShimmer();
      albumCoverImg.src = imgUrl || 'https://via.placeholder.com/600';

      audio.src = mp3Url;

      return true;
    }

    albumCoverImg.onload = () => {
      hideShimmer();
      backgroundBlur.style.backgroundImage = `url('${albumCoverImg.src}')`;
    };

    audio.addEventListener('loadedmetadata', () => {
      total.textContent = formatTime(audio.duration);
      progress.max = 100;
      progress.value = 0;
      updateProgressBackground(0);
    });

    audio.addEventListener('timeupdate', () => {
      if (audio.duration) {
        const progressValue = (audio.currentTime / audio.duration) * 100;
        progress.value = progressValue;
        updateProgressBackground(progressValue);
        current.textContent = formatTime(audio.currentTime);
      }
    });

    progress.addEventListener('input', () => {
      if (audio.duration) {
        audio.currentTime = (progress.value / 100) * audio.duration;
        updateProgressBackground(progress.value);
      }
    });

    playBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
      }
    });

    audio.addEventListener('play', () => {
      isPlaying = true;
      updatePlayPauseIcon();
    });

    audio.addEventListener('pause', () => {
      isPlaying = false;
      updatePlayPauseIcon();
    });

    repeatBtn.addEventListener('click', () => {
      isRepeat = !isRepeat;
      audio.loop = isRepeat;
      repeatBtn.classList.toggle('active-btn', isRepeat);
    });

    shuffleBtn.addEventListener('click', () => {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('active-btn', isShuffle);
    });

    // Simple next/back handlers (no playlist in this minimal version)
    nextBtn.addEventListener('click', () => {
      // No playlist implemented: just restart audio
      audio.currentTime = 0;
      audio.play();
    });

    backBtn.addEventListener('click', () => {
      audio.currentTime = 0;
      audio.play();
    });

    audio.addEventListener('ended', () => {
      if (!isRepeat) {
        isPlaying = false;
        updatePlayPauseIcon();
      }
    });

    // Like button toggle
    likeBtn.addEventListener('click', () => {
      if (likeIcon.classList.contains('fa-regular')) {
        likeIcon.classList.remove('fa-regular');
        likeIcon.classList.add('fa-solid');
        likeIcon.style.color = '#22c55e'; // verde
      } else {
        likeIcon.classList.remove('fa-solid');
        likeIcon.classList.add('fa-regular');
        likeIcon.style.color = 'inherit';
      }
    });
    likeBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        likeBtn.click();
      }
    });

    window.onload = () => {
      if (!loadFromURL()) {
        // No mp3 url provided: puedes cargar uno por defecto aquí si quieres
        // Ejemplo:
        // audio.src = "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3";
        // albumCoverImg.src = "https://via.placeholder.com/600";
        // hideShimmer();
      }
    };
  </script>

</body>
</html>
